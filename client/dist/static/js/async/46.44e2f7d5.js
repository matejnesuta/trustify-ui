"use strict";(self.webpackChunk_trustify_ui_client=self.webpackChunk_trustify_ui_client||[]).push([["46"],{92934:function(e,i,t){t.d(i,{F:()=>h,P:()=>y});var l=t(79192),n=t(53195),r=t(24246),a=t(27378),s=t(74502),o=t(32947),d=t(14629),u=t(49988),c=t(17598);let y=a.createContext({}),h=e=>{var i;let{children:t}=e,[h,m]=a.useState(""),[v,p]=a.useState("");a.useEffect(()=>{let e=setTimeout(()=>{p(h)},400);return()=>clearTimeout(e)},[h]);let{labels:x}=(0,c.VY)(v),f=(0,u.vZ)({tableName:"advisory",persistenceKeyPrefix:s.yq.advisories,persistTo:"urlParams",columnNames:{identifier:"ID",title:"Title",type:"Type",labels:"Labels",modified:"Revision",vulnerabilities:"Vulnerabilities"},isPaginationEnabled:!0,isSortEnabled:!0,sortableColumns:["identifier","modified"],initialSort:{columnKey:"modified",direction:"desc"},isFilterEnabled:!0,filterCategories:[{categoryKey:s.L4,title:"Filter text",placeholderText:"Search",type:d.vA.search},{categoryKey:"modified",title:"Revision",type:d.vA.dateRange},{categoryKey:"labels",title:"Label",type:d.vA.autocompleteLabel,placeholderText:"Filter results by label",selectOptions:x.map(e=>{let i=(0,o.W)({key:e.key,value:e.value});return{value:i,label:i}}),onInputValueChange:m}],isExpansionEnabled:!1}),{result:{data:b,total:_},isFetching:j,fetchError:g}=(0,c.N7)((0,u.QO)((0,n._)((0,l._)({},f),{hubSortFieldKeys:{identifier:"identifier",modified:"modified"}})),(null!=(i=f.filterState.filterValues.labels)?i:[]).map(e=>(0,o.nE)(e))),C=(0,u.KC)((0,n._)((0,l._)({},f),{idProperty:"identifier",currentPageItems:b,totalItemCount:_,isLoading:j}));return(0,r.jsx)(y.Provider,{value:{totalItemCount:_,isFetching:j,fetchError:g,tableControls:C},children:t})}},26179:function(e,i,t){t.d(i,{H:()=>A});var l=t(79192),n=t(53195),r=t(24246),a=t(27378),s=t(6501),o=t(79551),d=t(32489),u=t(90519),c=t(78700),y=t(4835),h=t(14350),m=t(11165),v=t(89330),p=t(31423),x=t(94154),f=t(88935),b=t(32947),_=t(7615),j=t(6348),g=t(73827),C=t(15726),K=t(3804),T=t(31336),w=t(49304),E=t(73227),L=t(17598),q=t(27031),S=t(63706),k=t(92934),P=t(15167),F=t(74502);let A=()=>{let{pushNotification:e}=a.useContext(C.c),{isFetching:i,fetchError:t,totalItemCount:A,tableControls:D}=a.useContext(k.P),[V,N]=a.useState(null),I=null!==V,{numRenderedColumns:B,currentPageItems:Q,propHelpers:{paginationProps:W,tableProps:O,getThProps:R,getTrProps:H,getTdProps:Y},expansionDerivedState:{isCellExpanded:G},filterState:{filterValues:U,setFilterValues:z}}=D,{downloadAdvisory:M}=(0,E.i)(),Z=()=>{N(null)},[J,X]=a.useState(null),{mutate:$,isPending:ee}=(0,L.y2)(i=>{X(null),e({title:"The Advisory ".concat(i.identifier," was deleted"),variant:"success"})},i=>{e({title:"Error occurred while deleting the Advisory",variant:"danger"})});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y.i,(0,n._)((0,l._)({},O),{"aria-label":"advisory-table",children:[(0,r.jsx)(h.h,{children:(0,r.jsx)(m.Tr,{children:(0,r.jsxs)(T.qK,(0,n._)((0,l._)({},D),{children:[(0,r.jsx)(v.Th,(0,l._)({},R({columnKey:"identifier"}))),(0,r.jsx)(v.Th,(0,l._)({},R({columnKey:"title"}))),(0,r.jsx)(v.Th,(0,l._)({},R({columnKey:"type"}))),(0,r.jsx)(v.Th,(0,l._)({},R({columnKey:"labels"}))),(0,r.jsx)(v.Th,(0,l._)({},R({columnKey:"modified"}))),(0,r.jsx)(v.Th,(0,l._)({},R({columnKey:"vulnerabilities"})))]}))})}),(0,r.jsx)(T.hp,{isLoading:i,isError:!!t,isNoData:0===A,numRenderedColumns:B,children:Q.map((e,i)=>{let t=e.vulnerabilities.reduce((e,i)=>{let t=(0,_.g)(i.severity);return e[t]=e[t]+1,e},{critical:0,high:0,medium:0,low:0,none:0,unknown:0});return(0,r.jsx)(p.p,{isExpanded:G(e),children:(0,r.jsx)(m.Tr,(0,n._)((0,l._)({},H({item:e})),{children:(0,r.jsxs)(T.Cx,(0,n._)((0,l._)({},D),{item:e,rowIndex:i,children:[(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:15,modifier:"breakWord"},Y({columnKey:"identifier",isCompoundExpandToggle:!0,item:e,rowIndex:i})),{children:(0,r.jsx)(s.OL,{to:(0,s.Gn)(q.nB.advisoryDetails,{advisoryId:e.uuid}),children:e.document_id})})),(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:35,modifier:"truncate"},Y({columnKey:"title"})),{children:e.title})),(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:10},Y({columnKey:"type"})),{children:e.labels.type})),(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:20},Y({columnKey:"labels"})),{children:(0,r.jsx)(g.C,{value:e.labels,onClick:e=>{let{key:i,value:t}=e,r=(0,b.W)({key:i,value:t}),a=U.labels;if(!(null==a?void 0:a.includes(r))){let e=a?[...a,r]:[r];z((0,n._)((0,l._)({},U),{labels:e}))}}})})),(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:10,modifier:"truncate"},Y({columnKey:"modified"})),{children:(0,S.p6)(e.modified)})),(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:10},Y({columnKey:"vulnerabilities"})),{children:(0,r.jsx)(w.u,{severities:t})})),(0,r.jsx)(x.Td,{isActionCell:!0,children:(0,r.jsx)(f.k,{items:[{title:"Edit labels",onClick:()=>{N(e)}},{title:"Download",onClick:()=>{M(e.uuid,"".concat(e.identifier,".json"))}},{isSeparator:!0},{title:"Delete",onClick:()=>{X(e)}}]})})]}))}))},e.identifier)})})]})),(0,r.jsx)(K.p,{idPrefix:"advisory-table",isTop:!1,paginationProps:W}),(0,r.jsxs)(o.u,{isOpen:I,variant:"medium",onClose:Z,children:[(0,r.jsx)(d.x,{title:"Edit labels"}),(0,r.jsx)(u.f,{children:V&&(0,r.jsx)(P.q,{advisory:V,onClose:Z})})]}),(0,r.jsx)(j.Q,(0,n._)((0,l._)({},(0,F.gn)(J)),{inProgress:ee,titleIconVariant:"warning",isOpen:!!J,confirmBtnVariant:c.Wu.danger,confirmBtnLabel:"Delete",cancelBtnLabel:"Cancel",onCancel:()=>X(null),onClose:()=>X(null),onConfirm:()=>{J&&$(J.uuid)}}))]})}},80475:function(e,i,t){t.d(i,{P:()=>p});var l=t(79192),n=t(53195),r=t(24246),a=t(27378),s=t(6501),o=t(70715),d=t(40982),u=t(89226),c=t(78700),y=t(14629),h=t(3804),m=t(27031),v=t(92934);let p=e=>{let{showFilters:i}=e,t=(0,s.s0)(),{tableControls:p}=a.useContext(v.P),{propHelpers:{toolbarProps:x,filterToolbarProps:f,paginationToolbarItemProps:b,paginationProps:_}}=p;return(0,r.jsx)(o.o,(0,n._)((0,l._)({},x),{"aria-label":"advisory-toolbar",children:(0,r.jsxs)(d.c,{children:[i&&(0,r.jsx)(y.Ki,(0,l._)({},f)),(0,r.jsx)(u.E,{children:(0,r.jsx)(c.zx,{variant:"primary",onClick:()=>t(m.nB.advisoryUpload),children:"Upload Advisory"})}),(0,r.jsx)(u.E,(0,n._)((0,l._)({},b),{children:(0,r.jsx)(h.p,{idPrefix:"advisory-table",isTop:!0,paginationProps:_})}))]})}))}},15167:function(e,i,t){t.d(i,{q:()=>o});var l=t(24246),n=t(27378),r=t(24502),a=t(15726),s=t(17598);let o=e=>{let{advisory:i,onClose:t}=e,{pushNotification:o}=n.useContext(a.c),[d,u]=n.useState(""),[c,y]=n.useState(""),{labels:h}=(0,s.VY)(c);n.useEffect(()=>{let e=setTimeout(()=>{y(d)},400);return()=>clearTimeout(e)},[d]);let{mutate:m,isPending:v}=(0,s.sj)(()=>{o({title:"Labels updated for Advisory ".concat(i.document_id),variant:"success"}),t()},e=>{o({title:"Error while updating labels for Advisory ".concat(i.document_id),variant:"danger"})});return(0,l.jsx)(r.M,{title:"Labels of Advisory: ".concat(i.document_id),value:i.labels,isDisabled:v,onSave:e=>{m({id:i.uuid,labels:e})},onClose:t,onInputChange:u,options:h})}},17598:function(e,i,t){t.d(i,{N7:()=>x,VY:()=>p,gw:()=>f,sj:()=>j,tG:()=>_,y2:()=>b});var l=t(79192),n=t(53195),r=t(70186),a=t(1183),s=t(24038),o=t(68e3),d=t(75503),u=t(50576),c=t(40371),y=t(87017),h=t(49988),m=t(95169);let v="advisories",p=e=>{let{data:i,isLoading:t,error:l,refetch:n}=(0,a.a)({queryKey:[v,"labels",e],queryFn:()=>(0,c.sf)({client:u.L,query:{limit:10,filter_text:e}}),placeholderData:s.Wk});return{labels:(null==i?void 0:i.data)||[],isFetching:t,fetchError:l,refetch:n}},x=function(){var e,i,t;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=(0,h.rm)(s),{q:m}=y,p=(0,r._)(y,["q"]),x=(0,h.Rb)(o),{data:f,isLoading:b,error:_,refetch:j}=(0,a.a)({queryKey:[v,s,x],queryFn:()=>(0,c.A1)({client:u.L,query:(0,n._)((0,l._)({},p),{q:[m,x].filter(e=>e).join("&")})}),enabled:!d});return{result:{data:(null==f||null==(e=f.data)?void 0:e.items)||[],total:null!=(t=null==f||null==(i=f.data)?void 0:i.total)?t:0,params:s},isFetching:b,fetchError:_||null,refetch:j}},f=e=>{let{data:i,isLoading:t,error:l}=(0,a.a)({queryKey:[v,e],queryFn:()=>(0,c.pB)({client:u.L,path:{key:e}}),enabled:void 0!==e});return{advisory:null==i?void 0:i.data,isFetching:t,fetchError:l}},b=(e,i)=>{let t=(0,o.NL)();return(0,d.D)({mutationFn:async e=>(await (0,c.Wr)({client:u.L,path:{key:e}})).data,onSuccess:async(i,l)=>{e(i,l),await t.invalidateQueries({queryKey:[v]})},onError:async e=>{i(e),await t.invalidateQueries({queryKey:[v]})}})},_=()=>{let e=(0,o.NL)();return(0,m.V)({parallel:!0,uploadFn:(e,i)=>(0,y.Cu)(e,i),onSuccess:async()=>{await e.invalidateQueries({queryKey:[v]})}})},j=(e,i)=>{let t=(0,o.NL)();return(0,d.D)({mutationFn:e=>(0,c.m5)({client:u.L,path:{id:e.id},body:e.labels}),onSuccess:async(i,l)=>{e(),await t.invalidateQueries({queryKey:[v]})},onError:i})}}}]);